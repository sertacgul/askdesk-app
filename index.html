<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AskDesk | askdesk.app</title>
    
    <!-- UI Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Data Libraries -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#0f172a',      
                            panel: '#1e293b',     
                            primary: '#6366f1',
                            accent: '#f43f5e',
                            success: '#10b981',
                            warning: '#f59e0b',
                            info: '#3b82f6',
                            pro: '#22c55e',       
                            enterprise: '#a855f7' 
                        }
                    }
                }
            }
        }
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        /* SCROLL BAR FIX: Enable native scrolling */
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            transition: all 0.3s; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            overflow-y: auto; /* Enable vertical scroll on body */
        }
        
        .glass-input { 
            background: #1e293b; 
            border: 1px solid #334155; 
            color: white; 
            transition: all 0.2s;
        }
        .glass-input:focus { 
            border-color: #6366f1; 
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); 
            outline: none; 
        }
        option { background-color: #1e293b; color: white; padding: 5px; }
        select { cursor: pointer; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #6366f1; cursor: pointer; margin-top: -6px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 5px; border: 2px solid #0f172a; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .loader {
            border: 3px solid #1e293b;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        html[dir="rtl"] .fa-chevron-right { transform: rotate(180deg); }
        html[dir="rtl"] .text-right { text-align: left; } 
        html[dir="rtl"] .text-left { text-align: right; }

        /* Copy Guard Class */
        .protected-text {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
    
    <!-- PWA Manifest & Service Worker -->
    <link rel="manifest" href="manifest.json">
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker failed', err));
        });
    }
    </script>
</head>
<body class="text-slate-200">

    <!-- HEADER -->
    <header class="bg-brand-panel border-b border-slate-700 h-auto min-h-[4rem] py-2 flex flex-wrap items-center justify-between px-4 md:px-6 shadow-lg z-20 shrink-0 gap-2 sticky top-0">
        <div class="flex items-center gap-3">
            <div class="relative w-8 h-8 md:w-10 md:h-10 group cursor-pointer">
                <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full drop-shadow-lg transform transition group-hover:scale-105 duration-300">
                    <rect width="40" height="40" rx="10" fill="url(#brand_gradient)"/>
                    <path d="M20 8C13.3726 8 8 13.3726 8 20C8 26.6274 13.3726 32 20 32C26.6274 32 32 26.6274 32 20C32 13.3726 26.6274 8 20 8ZM20 10.4C25.3019 10.4 29.6 14.6981 29.6 20C29.6 25.3019 25.3019 29.6 20 29.6C14.6981 29.6 10.4 25.3019 10.4 20C10.4 14.6981 14.6981 10.4 20 10.4Z" fill="white" fill-opacity="0.1"/>
                    <path d="M20 6V12M20 28V34M6 20H12M28 20H34" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <circle cx="20" cy="20" r="5" stroke="white" stroke-width="2"/>
                    <circle cx="20" cy="20" r="2" fill="#F43F5E"/>
                    <defs>
                        <linearGradient id="brand_gradient" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#6366F1"/>
                            <stop offset="1" stop-color="#8B5CF6"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <div>
                <h1 class="text-lg md:text-xl font-bold text-white tracking-wide">AskDesk</h1>
                <p class="text-[9px] md:text-[10px] text-slate-400 font-mono tracking-wider">Generated with responsibility by ATAOL AI Techs</p>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-2 ml-auto">
            <!-- Usage Badge -->
            <div id="usageBadge" class="h-8 px-3 rounded bg-slate-800 border border-slate-600 flex items-center justify-center text-[10px] text-slate-400 font-mono min-w-[3rem]">0/5</div>
            
            <!-- Plan Badge -->
            <button id="planBadge" class="h-8 px-3 text-[10px] font-bold rounded bg-slate-700 text-slate-300 uppercase tracking-wide border border-slate-600 transition-colors cursor-pointer flex items-center justify-center min-w-[4rem]" onclick="App.billing.cyclePlan()">Starter</button>
            
            <!-- Lang Select -->
            <select id="uiLangSelect" onchange="App.ui.changeLanguage(this.value)" class="h-8 bg-slate-800 border border-slate-600 text-xs rounded px-2 text-slate-300 outline-none focus:border-brand-primary cursor-pointer w-auto min-w-[4rem]"></select>
            
             <!-- Settings Trigger -->
             <button onclick="App.ui.toggleSettings()" class="h-8 w-8 rounded bg-slate-800 border border-slate-600 flex items-center justify-center text-slate-400 hover:text-white transition" title="User Settings"><i class="fa-solid fa-user-gear"></i></button>
        </div>
    </header>
<!-- SETTINGS PANEL (User Email & Magic Link) -->
    <div id="settingsPanel" class="hidden absolute top-16 right-4 w-80 md:w-96 bg-slate-800 border border-slate-600 shadow-2xl z-50 p-4 rounded-xl">
        <h3 class="text-sm font-bold text-white mb-2 flex items-center gap-2">
            <i class="fa-solid fa-user-shield text-brand-primary"></i> <span data-i18n="settingsTitle">User Account</span>
        </h3>
        <p class="text-[10px] text-slate-400 mb-3 leading-relaxed">
            Enter your email to sync your plan and limits. We will send a <b>Magic Link</b> to login.
        </p>
        <input type="email" id="userEmailInput" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-xs font-mono mb-3 focus:border-brand-primary outline-none" placeholder="user@example.com">
        
        <!-- Hidden API URL Input -->
        <input type="hidden" id="apiUrlInput">

        <div class="flex justify-end gap-2">
            <button onclick="App.ui.toggleSettings()" class="text-slate-400 hover:text-white text-xs px-3 py-1" data-i18n="cancel">Close</button>
            <button onclick="App.billing.saveUserEmail()" class="bg-brand-primary hover:bg-indigo-500 text-white px-4 py-1.5 rounded text-xs font-bold transition" data-i18n="save">Send Magic Link</button>
        </div>
    </div>

    <!-- MAIN -->
    <div class="flex flex-col md:flex-row min-h-[calc(100vh-4rem)]">
        
        <!-- LEFT: INPUTS -->
        <div class="w-full md:w-[40%] flex flex-col bg-slate-900 border-b md:border-b-0 md:border-r border-slate-700 relative">
            
            <!-- Scrollable Content Area -->
            <div class="flex-1 p-4 flex flex-col gap-3 overflow-y-auto">
                <!-- Config -->
                <div class="bg-brand-panel p-3 rounded-xl border border-slate-700 shadow-sm space-y-2 shrink-0">
                    <div class="flex justify-between items-center border-b border-slate-700 pb-1">
                        <h3 class="text-xs font-bold text-brand-primary uppercase flex items-center gap-2">
                            <i class="fa-solid fa-sliders"></i> <span data-i18n="configTitle">Configuration</span>
                        </h3>
                    </div>
                    
                    <div>
                        <label class="block text-[10px] text-slate-400 mb-0.5 uppercase font-bold" data-i18n="domainLabel">Domain</label>
                        <select id="domainSelect" class="glass-input w-full rounded px-2 py-1.5 text-xs cursor-pointer"></select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-[10px] text-slate-400 mb-0.5 uppercase font-bold" data-i18n="qLangLabel">Question Lang</label>
                            <select id="qLangSelect" class="glass-input w-full rounded px-2 py-1.5 text-xs cursor-pointer"></select>
                        </div>
                        <div>
                            <label class="block text-[10px] text-slate-400 mb-0.5 uppercase font-bold" data-i18n="aLangLabel">Answer Lang</label>
                            <select id="aLangSelect" class="glass-input w-full rounded px-2 py-1.5 text-xs cursor-pointer"></select>
                        </div>
                    </div>
                </div>

                <!-- Metadata -->
                <div class="bg-brand-panel p-3 rounded-xl border border-slate-700 shadow-sm hidden md:block shrink-0">
                    <h3 class="text-xs font-bold text-brand-primary uppercase mb-1 flex items-center gap-2">
                        <i class="fa-solid fa-tag"></i> <span data-i18n="metaTitle">Document Info</span>
                    </h3>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="col-span-2">
                            <label class="block text-[10px] text-slate-400 mb-0.5 uppercase" data-i18n="docNameLabel">Document Name</label>
                            <input type="text" id="docName" class="glass-input w-full rounded px-2 py-1 text-xs font-medium" placeholder="FCOM">
                        </div>
                        <div class="col-span-1">
                            <label class="block text-[10px] text-slate-400 mb-0.5 uppercase" data-i18n="pageNumLabel">Page</label>
                            <input type="text" id="pageNum" class="glass-input w-full rounded px-2 py-1 text-xs font-medium text-center" placeholder="123">
                        </div>
                    </div>
                </div>

                <!-- Source Input -->
                <div class="flex-1 flex flex-col min-h-[500px]"> 
                    <div class="flex items-center gap-2 mb-1">
                        <label class="text-[10px] font-bold text-slate-300 uppercase flex items-center gap-1 shrink-0">
                            <i class="fa-solid fa-align-left text-brand-primary"></i> <span data-i18n="sourceTextLabel">Source</span>
                        </label>
                        
                        <div class="flex gap-4 ml-3 items-center">
                            <div class="text-[9px] text-slate-500 font-mono">
                                Density: <span id="densityScore" class="text-slate-400">0</span> Q/Doc
                            </div>
                            <span id="charCount" class="text-[9px] text-slate-500">0 chars</span>
                        </div>
                        
                        <div class="flex-1"></div>

                        <input type="file" id="fileUpload" class="hidden" accept=".txt,.md,.csv,.json,.xml,.png,.jpg,.jpeg,.webp,.pdf,.docx,.xlsx" onchange="App.ui.handleFileUpload(this)">
                        
                        <button onclick="document.getElementById('fileUpload').click()" 
                            class="bg-slate-700 hover:bg-slate-600 text-brand-primary hover:text-white border border-slate-600 font-bold py-1 px-3 rounded shadow-md transition flex items-center gap-1 text-[10px] h-6 cursor-pointer">
                            <i class="fa-solid fa-cloud-arrow-up text-sm"></i> 
                            <span data-i18n="uploadBtn">UPLOAD</span>
                        </button>
                        
                        <button onclick="App.ui.clearInput()" class="bg-slate-800 hover:bg-red-900/30 text-slate-400 hover:text-red-400 border border-slate-700 font-bold py-1 px-3 rounded shadow-md transition flex items-center gap-1 text-[10px] h-6 cursor-pointer">
                            <i class="fa-solid fa-eraser"></i>
                            <span data-i18n="clear">CLEAR</span>
                        </button>
                    </div>

                    <div class="relative w-full flex-1">
                        <textarea id="sourceText" oninput="App.ui.handleTextChange()"
                            class="glass-input w-full h-[500px] rounded-xl p-3 text-xs font-mono leading-relaxed resize-none focus:ring-brand-primary whitespace-pre-wrap"
                            placeholder="Paste text here... (Long text enables Multi-Q option)"
                            data-i18n-placeholder="sourcePlaceholder"></textarea>
                        
                        <div id="imagePreviewContainer" class="hidden absolute inset-0 bg-slate-900/90 rounded-xl flex-col items-center justify-center border-2 border-dashed border-brand-primary z-10 p-4">
                            <img id="previewImgElement" class="max-h-[80%] max-w-full rounded shadow-lg object-contain mb-2" />
                            <div class="flex gap-2">
                                <span class="text-xs text-brand-primary bg-brand-primary/10 px-2 py-1 rounded">Image Mode Active</span>
                                <button onclick="App.ui.clearInput()" class="text-xs text-red-400 hover:text-white px-2 py-1 bg-red-900/20 rounded">Remove</button>
                            </div>
                        </div>

                        <div id="fileLoader" class="hidden absolute inset-0 bg-slate-900/80 z-20 flex-col items-center justify-center rounded-xl backdrop-blur-sm">
                            <div class="loader mb-2"></div>
                            <span class="text-xs text-brand-primary font-bold">Processing File...</span>
                        </div>
                    </div>
                </div>

                <!-- Bulk Panel -->
                <div id="bulkPanel" class="hidden bg-slate-800/50 border border-slate-700 rounded-xl p-2 mb-1 animate-in fade-in slide-in-from-bottom-4 shrink-0">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[10px] font-bold text-brand-warning flex items-center gap-1">
                            <i class="fa-solid fa-layer-group"></i> Bulk Mode
                        </span>
                        <span id="bulkLimitLabel" class="text-[9px] text-slate-400 bg-slate-800 px-2 py-0.5 rounded border border-slate-600">Max: 5</span>
                    </div>
                    
                    <div class="flex items-center gap-2 mb-1">
                        <input type="range" id="bulkRange" min="1" max="5" value="1" class="flex-1 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer" oninput="App.ui.updateBulkLabel(this.value)">
                        <span id="bulkValue" class="text-xs font-bold text-white w-6 text-center bg-brand-primary rounded px-0.5">1</span>
                    </div>
                    
                    <div id="bulkProgressContainer" class="hidden w-full bg-slate-700 rounded-full h-1.5 mb-1">
                        <div id="bulkProgressBar" class="bg-brand-success h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div id="bulkStatusText" class="hidden text-[9px] text-center text-slate-400 mb-1">Generating 0/0...</div>
                </div>
            </div>
<!-- Sticky Generate Button (Fixed Bottom) -->
            <div class="p-4 bg-slate-900 border-t border-slate-800 sticky bottom-0 z-20 shadow-[0_-5px_15px_rgba(0,0,0,0.5)]">
                <div id="errorBox" class="hidden mb-2 p-3 bg-red-900/40 border border-red-800 rounded text-red-200 text-xs flex flex-col gap-1 w-full relative">
                    <div class="flex items-center justify-between font-bold">
                        <div class="flex items-center gap-2"><i class="fa-solid fa-triangle-exclamation"></i> <span>Error</span></div>
                        <button onclick="document.getElementById('errorBox').classList.add('hidden')"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <span id="errorMsg">Details...</span>
                </div>
                
                <button id="analyzeBtn" onclick="App.logic.startGeneration()" class="w-full bg-brand-primary hover:bg-indigo-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-900/20 transition-all active:scale-[0.98] flex justify-center items-center gap-2 group cursor-pointer relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="btnText" class="text-sm md:text-base" data-i18n="analyzeBtn">Generate Q&A</span>
                    <i id="btnIcon" class="fa-solid fa-wand-magic-sparkles group-hover:rotate-12 transition-transform"></i>
                    <div id="btnLoader" class="loader hidden border-white/20 border-t-white"></div>
                    <div id="stopBtnOverlay" class="hidden absolute inset-0 bg-red-600 hover:bg-red-700 flex items-center justify-center gap-2 cursor-pointer" onclick="event.stopPropagation(); App.logic.stopBulk();">
                        <i class="fa-solid fa-stop"></i> STOP
                    </div>
                </button>
            </div>
        </div>

        <!-- RIGHT: OUTPUT -->
        <div class="w-full md:w-[60%] flex flex-col bg-[#0f172a]">
            <!-- Preview -->
            <div class="h-[40%] bg-slate-900/50 p-4 md:p-6 border-b border-slate-700 overflow-y-auto relative">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-xs md:text-sm font-bold text-brand-primary uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-clipboard-check"></i> <span data-i18n="previewTitle">AI Output Preview</span>
                        <a href="https://api.askdesk.app/billing/upgrade?plan=pro" target="_blank" id="previewUpgradeBtn" class="hidden ml-2 text-[9px] bg-brand-pro text-white px-2 py-0.5 rounded hover:bg-green-600 transition">UPGRADE</a>
                    </h2>
                    <span id="statusTag" class="text-[9px] bg-slate-800 text-slate-500 px-2 py-1 rounded border border-slate-700" data-i18n="statusReady">Ready</span>
                </div>

                <div id="qualityBox" class="hidden mb-3 p-2 bg-slate-800/50 rounded-lg border border-slate-700 text-xs">
                    <div class="flex items-center justify-between mb-1">
                        <div class="flex items-center gap-2">
                            <span class="font-bold uppercase text-slate-400 text-[10px]" data-i18n="qualityScore">Quality Score</span>
                            <span id="qScoreBadge" class="px-1.5 py-0.5 rounded text-white font-bold text-[10px]">0</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold uppercase text-slate-400 text-[10px]" data-i18n="groundingStatus">Grounding</span>
                            <span id="groundingBadge" class="px-1.5 py-0.5 rounded text-white font-bold text-[10px]">-</span>
                        </div>
                    </div>
                    <ul id="qReasons" class="list-disc list-inside text-slate-400 mb-1 italic text-[10px]"></ul>
                    <details class="group">
                        <summary class="cursor-pointer text-brand-info hover:text-white font-semibold select-none flex items-center gap-1 text-[10px]">
                            <i class="fa-solid fa-chevron-right text-[9px] group-open:rotate-90 transition"></i>
                            <span data-i18n="viewExtract">View Source Extract</span>
                        </summary>
                        <div class="mt-1 p-2 bg-slate-900 rounded border border-slate-700 font-mono text-[9px] text-slate-300 whitespace-pre-wrap" id="extractPreview"></div>
                    </details>
                </div>

                <div class="space-y-3 pb-8">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase block mb-0.5" data-i18n="generatedQ">Question</label>
                        <textarea id="questionOutput" class="glass-input w-full rounded-lg p-3 text-white text-xs md:text-sm font-bold h-14 md:h-16 protected-text" readonly></textarea>
                    </div>
                    <div class="h-32 md:h-40 flex flex-col">
                        <label class="text-[10px] font-bold text-slate-400 uppercase block mb-0.5" data-i18n="generatedA">Answer</label>
                        <textarea id="answerOutput" class="glass-input w-full flex-1 rounded-lg p-3 text-slate-300 text-xs md:text-sm font-mono whitespace-pre protected-text" readonly></textarea>
                    </div>
                    <div class="flex justify-end gap-2 pt-1">
                        <button id="regenerateBtn" onclick="App.logic.regenerate()" disabled class="text-[10px] md:text-xs text-brand-primary hover:text-white font-bold px-3 py-1.5 border border-brand-primary/50 hover:border-brand-primary rounded-lg transition flex items-center gap-2 opacity-50 cursor-not-allowed">
                            <i class="fa-solid fa-rotate"></i> <span data-i18n="regenerateBtn">Regenerate</span>
                        </button>
                        <button id="addToLogBtn" onclick="App.logic.addToLog()" disabled class="bg-slate-800 text-slate-500 font-semibold px-4 py-1.5 rounded-lg border border-slate-700 transition cursor-not-allowed flex items-center gap-2 text-[10px] md:text-xs">
                            <i class="fa-solid fa-circle-plus"></i> <span data-i18n="addBtn">Add to Log</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Log Table -->
            <div class="flex-1 flex flex-col bg-[#0f172a] overflow-hidden">
                <div class="bg-slate-900 border-b border-slate-800 px-4 py-2 shadow-md z-10 shrink-0 flex flex-col gap-2">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-bold text-slate-300"><span data-i18n="logTitle">Session Log</span> (<span id="counterDisplay">0</span>)</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="flex bg-slate-800 rounded-lg p-0.5 border border-slate-700">
                                <button id="btnExportExcel" onclick="App.exporters.toExcel()" class="px-2 py-1 text-[9px] font-bold text-slate-300 hover:text-white hover:bg-slate-700 rounded transition hidden" title="Export Excel" data-export="excel"><i class="fa-solid fa-file-excel text-green-500 mr-1"></i> XLSX</button>
                                <div class="w-px bg-slate-700 my-1"></div>
                                <button id="btnExportCSV" onclick="App.exporters.toCSV()" class="px-2 py-1 text-[9px] font-bold text-slate-300 hover:text-white hover:bg-slate-700 rounded transition hidden" title="Export CSV" data-export="csv"><i class="fa-solid fa-file-csv text-blue-500 mr-1"></i> CSV</button>
                                <div class="w-px bg-slate-700 my-1"></div>
                                <button id="btnExportJSON" onclick="App.exporters.toJSON()" class="px-2 py-1 text-[9px] font-bold text-slate-300 hover:text-white hover:bg-slate-700 rounded transition hidden" title="Export JSON" data-export="json"><i class="fa-solid fa-code text-yellow-500 mr-1"></i> JSON</button>
                            </div>
                            <button onclick="App.logic.clearLog()" class="text-xs text-red-400 hover:text-red-300 ml-2" title="Clear All"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                    
                    <div class="flex gap-1 items-center pb-1 overflow-x-auto no-scrollbar">
                        <select id="filterDomain" onchange="App.logic.renderTable()" class="bg-slate-800 border border-slate-700 text-[10px] text-slate-300 rounded px-1 py-0.5 outline-none focus:border-brand-primary cursor-pointer min-w-[80px]">
                            <option value="all" data-i18n="allDomains">All Domains</option>
                        </select>
                        <select id="filterStatus" onchange="App.logic.renderTable()" class="bg-slate-800 border border-slate-700 text-[10px] text-slate-300 rounded px-1 py-0.5 outline-none focus:border-brand-primary cursor-pointer min-w-[80px]">
                            <option value="all" data-i18n="allStatuses">All Statuses</option>
                            <option value="Draft">Draft</option>
                            <option value="Reviewed">Reviewed</option>
                            <option value="Approved">Approved</option>
                        </select>
                        <input type="text" id="filterSearch" oninput="App.logic.renderTable()" placeholder="Search..." class="bg-slate-800 border border-slate-700 text-[10px] text-slate-300 rounded px-2 py-0.5 w-full md:w-32 outline-none focus:border-brand-primary placeholder:text-slate-600">
                    </div>
                </div>
                <div class="flex-1 overflow-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-800 text-xs uppercase sticky top-0 z-10 shadow-sm text-slate-400">
                            <tr>
                                <th class="px-4 py-3 font-semibold border-b border-slate-700 w-12">#</th>
                                <th class="px-4 py-3 font-semibold border-b border-slate-700 w-24" data-i18n="thDoc">Doc</th>
                                <th class="px-4 py-3 font-semibold border-b border-slate-700" data-i18n="thContent">Q & A</th>
                                <th class="px-4 py-3 font-semibold border-b border-slate-700 w-28" data-i18n="thMeta">Meta</th>
                                <th class="px-4 py-3 font-semibold border-b border-slate-700 w-16"></th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody" class="text-sm divide-y divide-slate-800/50"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-slate-800 border border-slate-600 rounded-xl p-4 w-96 shadow-2xl">
            <h3 class="text-sm font-bold text-white mb-2" data-i18n="reviewerNotes">Reviewer Notes</h3>
            <textarea id="notesInput" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-xs text-white h-24 mb-3 resize-none focus:border-brand-primary outline-none"></textarea>
            <div class="flex justify-end gap-2">
                <button onclick="document.getElementById('notesModal').classList.add('hidden')" class="text-slate-400 text-xs hover:text-white px-3 py-1" data-i18n="cancel">Cancel</button>
                <button onclick="App.logic.saveNotes()" class="bg-brand-primary text-white text-xs px-4 py-1 rounded hover:bg-indigo-500" data-i18n="save">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-brand-success text-white px-4 py-3 rounded-lg shadow-2xl transform translate-y-24 transition duration-300 flex items-center gap-3 z-50 border border-green-400">
        <i class="fa-solid fa-check-circle text-lg"></i>
        <div>
            <h4 class="font-bold text-sm" data-i18n="success">Success</h4>
            <p class="text-xs text-green-100" id="toastMsg">Action completed.</p>
        </div>
        <a id="toastActionBtn" href="https://api.askdesk.app/billing/upgrade" target="_blank" class="hidden ml-2 bg-white text-brand-success text-xs font-bold px-2 py-1 rounded hover:bg-gray-100 uppercase">UPGRADE</a>
    </div>

    <!-- APP LOGIC -->
    <script>
    const App = {
        api: { 
            primary: "https://api.askdesk.app",
            current: "https://api.askdesk.app" 
        },

        config: {
            languages: [
                {code: 'en', label: 'English'}, {code: 'tr', label: 'TÃ¼rkÃ§e'}, {code: 'de', label: 'Deutsch'},
                {code: 'fr', label: 'FranÃ§ais'}, {code: 'es', label: 'EspaÃ±ol'}, {code: 'pt-BR', label: 'PortuguÃªs'},
                {code: 'ja', label: 'æ—¥æœ¬èª'}, {code: 'zh', label: 'ç®€ä½“ä¸­æ–‡'}, {code: 'ko', label: 'í•œêµ­ì–´'},
                {code: 'pl', label: 'Polski'}, {code: 'nl', label: 'Nederlands'}, {code: 'hi', label: 'à¤¹à¤¿à¤¨à¥à¤¦à¥€'},
                {code: 'ru', label: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹'}, {code: 'ar', label: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', dir: 'rtl'}
            ],
            domains: [
                {id: 'general', label: 'General'},
                {id: 'aviation', label: 'Aviation'},
                {id: 'strategy', label: 'Strategy'},
                {id: 'legal', label: 'Legal'},
                {id: 'medical', label: 'Medical'},
                {id: 'compliance', label: 'Compliance / ISO'}
            ],
            plans: {
                'starter': { dailyLimit: 5, maxBulk: 5, label: 'Starter', canExport: [], canCopy: false },
                'pro': { dailyLimit: 100, maxBulk: 20, label: 'Pro', canExport: ['excel', 'csv'], canCopy: false },
                'enterprise': { dailyLimit: Infinity, maxBulk: 100, label: 'Enterprise', canExport: ['excel', 'csv', 'json'], canCopy: true }
            },
            UPGRADE_URL: "https://api.askdesk.app/billing/upgrade"
        },

        data: {
            qaLog: [],
            previewState: null,
            editingNoteId: null,
            currentImage: null,
            abortController: null, 
            bulkActive: false
        },

        storage: {
            getPrefs: () => JSON.parse(localStorage.getItem('askdesk_prefs') || '{"uiLang":"en","domain":"general"}'),
            savePrefs: (p) => localStorage.setItem('askdesk_prefs', JSON.stringify({...App.storage.getPrefs(), ...p})),
            saveApiUrl: () => {
                const url = document.getElementById('apiUrlInput').value.trim();
                if(url) { 
                    localStorage.setItem('askdesk_api_base', url); 
                    App.api.current = url;
                    App.ui.toggleSettings();
                    App.ui.showToast("API URL Updated");
                }
            }
        },

        // --- I18N MODULE ---
        i18n: {
            currentLang: 'en',
            translations: {
en: {
                    bannerWarning: "ğŸ”’ Secure Mode: API Key is managed server-side. Do not paste PII.",
                    appSubtitle: "PROD SERVER EDITION",
                    settingsTitle: "User Account", settingsDesc: "Enter backend URL (e.g. https://my-worker.dev)",
                    configTitle: "Configuration", domainLabel: "Domain", qLangLabel: "Question Lang", aLangLabel: "Answer Lang",
                    metaTitle: "Document Info", docNameLabel: "Doc Name", pageNumLabel: "Page Ref",
                    sourceTextLabel: "Source Content", sourcePlaceholder: "Paste text here... (Long text enables Multi-Q option)",
                    clear: "Clear", error: "Error",
                    analyzeBtn: "Generate Q&A", previewTitle: "AI Output Preview", statusReady: "Ready",
                    generatedQ: "Question", generatedA: "Answer", addBtn: "Add to Log", regenerateBtn: "Regenerate",
                    logTitle: "Session Log", thDoc: "Doc", thContent: "Q & A", thMeta: "Meta",
                    noData: "No entries yet.", success: "Success", analyzing: "Analyzing...",
                    minCharsErr: "Please provide text or an image.",
                    notFound: "Not found in provided text",
                    uploadBtn: "UPLOAD FILE", uploadError: "File format not supported.",
                    qualityScore: "Quality Score", groundingStatus: "Grounding",
                    viewExtract: "View Source Extract", reviewerNotes: "Reviewer Notes",
                    allDomains: "All Domains", allStatuses: "All Statuses",
                    statusDraft: "Draft", statusReviewed: "Reviewed", statusApproved: "Approved",
                    cancel: "Cancel", save: "Save",
                    limitReached: "Limit reached â€“ Upgrade to Pro",
                    upgradeBtn: "Upgrade to Pro",
                    copyRestricted: "This content is protected. Upgrade to export."
                },
                tr: {
                    bannerWarning: "ğŸ”’ GÃ¼venli Mod: API AnahtarÄ± sunucuda yÃ¶netilir. Gizli veri girmeyin.",
                    appSubtitle: "PROD SUNUCU SÃœRÃœMÃœ",
                    settingsTitle: "KullanÄ±cÄ± HesabÄ±", settingsDesc: "Backend URL giriniz (Ã¶rn. https://my-worker.dev)",
                    configTitle: "YapÄ±landÄ±rma", domainLabel: "Alan", qLangLabel: "Soru Dili", aLangLabel: "Cevap Dili",
                    metaTitle: "DokÃ¼man", docNameLabel: "DokÃ¼man AdÄ±", pageNumLabel: "Sayfa",
                    sourceTextLabel: "Kaynak Ä°Ã§erik", sourcePlaceholder: "Metni buraya yapÄ±ÅŸtÄ±rÄ±n... (Uzun metin Multi-Q aÃ§ar)",
                    clear: "Temizle", error: "Hata",
                    analyzeBtn: "OluÅŸtur", previewTitle: "Ã–nizleme", statusReady: "HazÄ±r",
                    generatedQ: "Soru", generatedA: "Cevap", addBtn: "Listeye Ekle", regenerateBtn: "Yeniden Ãœret",
                    logTitle: "KayÄ±tlar", thDoc: "DokÃ¼man", thContent: "Soru & Cevap", thMeta: "Detay",
                    noData: "Veri yok.", success: "BaÅŸarÄ±lÄ±", analyzing: "Ä°ÅŸleniyor...",
                    minCharsErr: "LÃ¼tfen metin girin veya gÃ¶rsel yÃ¼kleyin.",
                    notFound: "Metinde bulunamadÄ±",
                    uploadBtn: "DOSYA YÃœKLE", uploadError: "Format desteklenmiyor.",
                    qualityScore: "Kalite PuanÄ±", groundingStatus: "Dayanak",
                    viewExtract: "AlÄ±ntÄ±yÄ± GÃ¶ster", reviewerNotes: "Ä°nceleme NotlarÄ±",
                    allDomains: "TÃ¼m Alanlar", allStatuses: "TÃ¼m Durumlar",
                    statusDraft: "Taslak", statusReviewed: "Ä°ncelendi", statusApproved: "OnaylandÄ±",
                    cancel: "Ä°ptal", save: "Kaydet",
                    limitReached: "Limit doldu â€“ Pro'ya GeÃ§",
                    upgradeBtn: "Pro'ya YÃ¼kselt",
                    copyRestricted: "Bu iÃ§erik korunuyor. Export Ã¶zelliÄŸini kullanÄ±n."
                },

                de: {
                    bannerWarning: "ğŸ”’ Sicherer Modus: API-Key wird serverseitig verwaltet. Keine sensiblen Daten einfÃ¼gen.",
                    appSubtitle: "PROD-SERVER-EDITION",
                    settingsTitle: "Benutzerkonto", settingsDesc: "Backend-URL eingeben (z.B. https://my-worker.dev)",
                    configTitle: "Konfiguration", domainLabel: "Bereich", qLangLabel: "Frage-Sprache", aLangLabel: "Antwort-Sprache",
                    metaTitle: "Dokumentinfo", docNameLabel: "Dokumentname", pageNumLabel: "Seite",
                    sourceTextLabel: "Quellinhalt", sourcePlaceholder: "Text hier einfÃ¼gen... (Langer Text aktiviert Multi-Q)",
                    clear: "LÃ¶schen", error: "Fehler",
                    analyzeBtn: "Q&A erstellen", previewTitle: "KI-Ausgabe Vorschau", statusReady: "Bereit",
                    generatedQ: "Frage", generatedA: "Antwort", addBtn: "Zum Protokoll", regenerateBtn: "Neu generieren",
                    logTitle: "Sitzungsprotokoll", thDoc: "Dok", thContent: "F & A", thMeta: "Meta",
                    noData: "Noch keine EintrÃ¤ge.", success: "Erfolg", analyzing: "Analysiere...",
                    minCharsErr: "Bitte Text oder ein Bild bereitstellen.",
                    notFound: "Im Text nicht gefunden",
                    uploadBtn: "DATEI HOCHLADEN", uploadError: "Dateiformat nicht unterstÃ¼tzt.",
                    qualityScore: "QualitÃ¤tswert", groundingStatus: "Bezug",
                    viewExtract: "Quellauszug anzeigen", reviewerNotes: "PrÃ¼fernotizen",
                    allDomains: "Alle Bereiche", allStatuses: "Alle Status",
                    statusDraft: "Entwurf", statusReviewed: "GeprÃ¼ft", statusApproved: "Genehmigt",
                    cancel: "Abbrechen", save: "Speichern",
                    limitReached: "Limit erreicht â€“ Upgrade auf Pro",
                    upgradeBtn: "Upgrade auf Pro",
                    copyRestricted: "Dieser Inhalt ist geschÃ¼tzt. Upgrade zum Export."
                },

                fr: {
                    bannerWarning: "ğŸ”’ Mode sÃ©curisÃ© : la clÃ© API est gÃ©rÃ©e cÃ´tÃ© serveur. Ne collez pas de donnÃ©es sensibles.",
                    appSubtitle: "Ã‰DITION SERVEUR PROD",
                    settingsTitle: "Compte utilisateur", settingsDesc: "Saisir lâ€™URL backend (ex. https://my-worker.dev)",
                    configTitle: "Configuration", domainLabel: "Domaine", qLangLabel: "Langue question", aLangLabel: "Langue rÃ©ponse",
                    metaTitle: "Infos document", docNameLabel: "Nom du doc", pageNumLabel: "Page",
                    sourceTextLabel: "Contenu source", sourcePlaceholder: "Collez le texte ici... (Texte long = Multi-Q)",
                    clear: "Effacer", error: "Erreur",
                    analyzeBtn: "GÃ©nÃ©rer Q&R", previewTitle: "AperÃ§u IA", statusReady: "PrÃªt",
                    generatedQ: "Question", generatedA: "RÃ©ponse", addBtn: "Ajouter au log", regenerateBtn: "RÃ©gÃ©nÃ©rer",
                    logTitle: "Journal de session", thDoc: "Doc", thContent: "Q & R", thMeta: "Meta",
                    noData: "Aucune entrÃ©e.", success: "SuccÃ¨s", analyzing: "Analyse...",
                    minCharsErr: "Veuillez fournir du texte ou une image.",
                    notFound: "Introuvable dans le texte",
                    uploadBtn: "TÃ‰LÃ‰VERSER", uploadError: "Format de fichier non pris en charge.",
                    qualityScore: "Score qualitÃ©", groundingStatus: "Ancrage",
                    viewExtract: "Voir lâ€™extrait", reviewerNotes: "Notes du relecteur",
                    allDomains: "Tous domaines", allStatuses: "Tous statuts",
                    statusDraft: "Brouillon", statusReviewed: "Revu", statusApproved: "ApprouvÃ©",
                    cancel: "Annuler", save: "Enregistrer",
                    limitReached: "Limite atteinte â€“ Passer Ã  Pro",
                    upgradeBtn: "Passer Ã  Pro",
                    copyRestricted: "Contenu protÃ©gÃ©. Upgrade pour exporter."
                },

                es: {
                    bannerWarning: "ğŸ”’ Modo seguro: la clave API se gestiona en el servidor. No pegues datos sensibles.",
                    appSubtitle: "EDICIÃ“N SERVIDOR PROD",
                    settingsTitle: "Cuenta de usuario", settingsDesc: "Introduce la URL del backend (ej. https://my-worker.dev)",
                    configTitle: "ConfiguraciÃ³n", domainLabel: "Dominio", qLangLabel: "Idioma pregunta", aLangLabel: "Idioma respuesta",
                    metaTitle: "Info del documento", docNameLabel: "Nombre del doc", pageNumLabel: "PÃ¡gina",
                    sourceTextLabel: "Contenido fuente", sourcePlaceholder: "Pega el texto aquÃ­... (Texto largo habilita Multi-Q)",
                    clear: "Limpiar", error: "Error",
                    analyzeBtn: "Generar P&R", previewTitle: "Vista previa IA", statusReady: "Listo",
                    generatedQ: "Pregunta", generatedA: "Respuesta", addBtn: "AÃ±adir al registro", regenerateBtn: "Regenerar",
                    logTitle: "Registro de sesiÃ³n", thDoc: "Doc", thContent: "P & R", thMeta: "Meta",
                    noData: "Sin entradas.", success: "Ã‰xito", analyzing: "Analizando...",
                    minCharsErr: "Proporciona texto o una imagen.",
                    notFound: "No encontrado en el texto",
                    uploadBtn: "SUBIR ARCHIVO", uploadError: "Formato no compatible.",
                    qualityScore: "PuntuaciÃ³n de calidad", groundingStatus: "Anclaje",
                    viewExtract: "Ver extracto", reviewerNotes: "Notas del revisor",
                    allDomains: "Todos los dominios", allStatuses: "Todos los estados",
                    statusDraft: "Borrador", statusReviewed: "Revisado", statusApproved: "Aprobado",
                    cancel: "Cancelar", save: "Guardar",
                    limitReached: "LÃ­mite alcanzado â€“ Actualiza a Pro",
                    upgradeBtn: "Actualizar a Pro",
                    copyRestricted: "Contenido protegido. Actualiza para exportar."
                },

                pt-BR: {
                    bannerWarning: "ğŸ”’ Modo seguro: a chave da API Ã© gerenciada no servidor. NÃ£o cole dados sensÃ­veis.",
                    appSubtitle: "EDIÃ‡ÃƒO SERVIDOR PROD",
                    settingsTitle: "Conta do usuÃ¡rio", settingsDesc: "Insira a URL do backend (ex. https://my-worker.dev)",
                    configTitle: "ConfiguraÃ§Ã£o", domainLabel: "DomÃ­nio", qLangLabel: "Idioma da pergunta", aLangLabel: "Idioma da resposta",
                    metaTitle: "Info do documento", docNameLabel: "Nome do doc", pageNumLabel: "PÃ¡gina",
                    sourceTextLabel: "ConteÃºdo fonte", sourcePlaceholder: "Cole o texto aqui... (Texto longo ativa Multi-Q)",
                    clear: "Limpar", error: "Erro",
                    analyzeBtn: "Gerar P&R", previewTitle: "PrÃ©via da IA", statusReady: "Pronto",
                    generatedQ: "Pergunta", generatedA: "Resposta", addBtn: "Adicionar ao log", regenerateBtn: "Regenerar",
                    logTitle: "Log da sessÃ£o", thDoc: "Doc", thContent: "P & R", thMeta: "Meta",
                    noData: "Sem entradas.", success: "Sucesso", analyzing: "Analisando...",
                    minCharsErr: "ForneÃ§a texto ou uma imagem.",
                    notFound: "NÃ£o encontrado no texto",
                    uploadBtn: "ENVIAR ARQUIVO", uploadError: "Formato nÃ£o suportado.",
                    qualityScore: "PontuaÃ§Ã£o de qualidade", groundingStatus: "Base",
                    viewExtract: "Ver trecho", reviewerNotes: "Notas do revisor",
                    allDomains: "Todos os domÃ­nios", allStatuses: "Todos os status",
                    statusDraft: "Rascunho", statusReviewed: "Revisado", statusApproved: "Aprovado",
                    cancel: "Cancelar", save: "Salvar",
                    limitReached: "Limite atingido â€“ Upgrade para Pro",
                    upgradeBtn: "Upgrade para Pro",
                    copyRestricted: "ConteÃºdo protegido. FaÃ§a upgrade para exportar."
                },

                ja: {
                    bannerWarning: "ğŸ”’ ã‚»ã‚­ãƒ¥ã‚¢ãƒ¢ãƒ¼ãƒ‰: APIã‚­ãƒ¼ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§ç®¡ç†ã€‚æ©Ÿå¯†æƒ…å ±ã¯è²¼ã‚Šä»˜ã‘ãªã„ã§ãã ã•ã„ã€‚",
                    appSubtitle: "PROD ã‚µãƒ¼ãƒãƒ¼ç‰ˆ",
                    settingsTitle: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ", settingsDesc: "ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’å…¥åŠ› (ä¾‹: https://my-worker.dev)",
                    configTitle: "è¨­å®š", domainLabel: "ãƒ‰ãƒ¡ã‚¤ãƒ³", qLangLabel: "è³ªå•è¨€èª", aLangLabel: "å›ç­”è¨€èª",
                    metaTitle: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±", docNameLabel: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå", pageNumLabel: "ãƒšãƒ¼ã‚¸",
                    sourceTextLabel: "ã‚½ãƒ¼ã‚¹å†…å®¹", sourcePlaceholder: "ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘...ï¼ˆé•·æ–‡ã§Multi-Qæœ‰åŠ¹ï¼‰",
                    clear: "ã‚¯ãƒªã‚¢", error: "ã‚¨ãƒ©ãƒ¼",
                    analyzeBtn: "Q&Aç”Ÿæˆ", previewTitle: "AIå‡ºåŠ›ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼", statusReady: "æº–å‚™å®Œäº†",
                    generatedQ: "è³ªå•", generatedA: "å›ç­”", addBtn: "ãƒ­ã‚°ã«è¿½åŠ ", regenerateBtn: "å†ç”Ÿæˆ",
                    logTitle: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ­ã‚°", thDoc: "Doc", thContent: "Q & A", thMeta: "Meta",
                    noData: "ã¾ã ã‚¨ãƒ³ãƒˆãƒªãŒã‚ã‚Šã¾ã›ã‚“ã€‚", success: "æˆåŠŸ", analyzing: "è§£æä¸­...",
                    minCharsErr: "ãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯ç”»åƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
                    notFound: "ãƒ†ã‚­ã‚¹ãƒˆå†…ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
                    uploadBtn: "ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šä¼ ", uploadError: "æœªå¯¾å¿œã®å½¢å¼ã§ã™ã€‚",
                    qualityScore: "å“è³ªã‚¹ã‚³ã‚¢", groundingStatus: "æ ¹æ‹ ",
                    viewExtract: "æŠœç²‹ã‚’è¡¨ç¤º", reviewerNotes: "ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ",
                    allDomains: "ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³", allStatuses: "ã™ã¹ã¦ã®çŠ¶æ…‹",
                    statusDraft: "ä¸‹æ›¸ã", statusReviewed: "ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¸ˆã¿", statusApproved: "æ‰¿èªæ¸ˆã¿",
                    cancel: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", save: "ä¿å­˜",
                    limitReached: "ä¸Šé™ã«é”ã—ã¾ã—ãŸ â€“ Proã¸ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰",
                    upgradeBtn: "Proã¸ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰",
                    copyRestricted: "ä¿è­·ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚"
                },

                zh: {
                    bannerWarning: "ğŸ”’ å®‰å…¨æ¨¡å¼ï¼šAPI Key ç”±æœåŠ¡ç«¯ç®¡ç†ï¼Œè¯·å‹¿ç²˜è´´æ•æ„Ÿä¿¡æ¯ã€‚",
                    appSubtitle: "ç”Ÿäº§æœåŠ¡å™¨ç‰ˆ",
                    settingsTitle: "ç”¨æˆ·è´¦æˆ·", settingsDesc: "è¾“å…¥åç«¯URLï¼ˆä¾‹å¦‚ https://my-worker.devï¼‰",
                    configTitle: "é…ç½®", domainLabel: "é¢†åŸŸ", qLangLabel: "é—®é¢˜è¯­è¨€", aLangLabel: "å›ç­”è¯­è¨€",
                    metaTitle: "æ–‡æ¡£ä¿¡æ¯", docNameLabel: "æ–‡æ¡£å", pageNumLabel: "é¡µç ",
                    sourceTextLabel: "æ¥æºå†…å®¹", sourcePlaceholder: "åœ¨æ­¤ç²˜è´´æ–‡æœ¬...ï¼ˆé•¿æ–‡æœ¬å¯ç”¨ Multi-Qï¼‰",
                    clear: "æ¸…ç©º", error: "é”™è¯¯",
                    analyzeBtn: "ç”Ÿæˆé—®ç­”", previewTitle: "AIè¾“å‡ºé¢„è§ˆ", statusReady: "å°±ç»ª",
                    generatedQ: "é—®é¢˜", generatedA: "ç­”æ¡ˆ", addBtn: "åŠ å…¥è®°å½•", regenerateBtn: "é‡æ–°ç”Ÿæˆ",
                    logTitle: "ä¼šè¯è®°å½•", thDoc: "æ–‡æ¡£", thContent: "é—®&ç­”", thMeta: "å…ƒä¿¡æ¯",
                    noData: "æš‚æ— è®°å½•ã€‚", success: "æˆåŠŸ", analyzing: "åˆ†æä¸­...",
                    minCharsErr: "è¯·æä¾›æ–‡æœ¬æˆ–å›¾ç‰‡ã€‚",
                    notFound: "åœ¨æ–‡æœ¬ä¸­æœªæ‰¾åˆ°",
                    uploadBtn: "ä¸Šä¼ æ–‡ä»¶", uploadError: "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ã€‚",
                    qualityScore: "è´¨é‡åˆ†æ•°", groundingStatus: "ä¾æ®",
                    viewExtract: "æŸ¥çœ‹æ‘˜å½•", reviewerNotes: "å®¡æ ¸å¤‡æ³¨",
                    allDomains: "æ‰€æœ‰é¢†åŸŸ", allStatuses: "æ‰€æœ‰çŠ¶æ€",
                    statusDraft: "è‰ç¨¿", statusReviewed: "å·²å®¡æ ¸", statusApproved: "å·²æ‰¹å‡†",
                    cancel: "å–æ¶ˆ", save: "ä¿å­˜",
                    limitReached: "è¾¾åˆ°ä¸Šé™ â€“ å‡çº§åˆ° Pro",
                    upgradeBtn: "å‡çº§åˆ° Pro",
                    copyRestricted: "å†…å®¹å—ä¿æŠ¤ã€‚å‡çº§åå¯å¯¼å‡ºã€‚"
                },

                ko: {
                    bannerWarning: "ğŸ”’ ë³´ì•ˆ ëª¨ë“œ: API í‚¤ëŠ” ì„œë²„ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤. ë¯¼ê°ì •ë³´ë¥¼ ë¶™ì—¬ë„£ì§€ ë§ˆì„¸ìš”.",
                    appSubtitle: "PROD ì„œë²„ ì—ë””ì…˜",
                    settingsTitle: "ì‚¬ìš©ì ê³„ì •", settingsDesc: "ë°±ì—”ë“œ URL ì…ë ¥ (ì˜ˆ: https://my-worker.dev)",
                    configTitle: "ì„¤ì •", domainLabel: "ë„ë©”ì¸", qLangLabel: "ì§ˆë¬¸ ì–¸ì–´", aLangLabel: "ë‹µë³€ ì–¸ì–´",
                    metaTitle: "ë¬¸ì„œ ì •ë³´", docNameLabel: "ë¬¸ì„œëª…", pageNumLabel: "í˜ì´ì§€",
                    sourceTextLabel: "ì›ë¬¸ ë‚´ìš©", sourcePlaceholder: "ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ê¸°... (ê¸´ í…ìŠ¤íŠ¸ëŠ” Multi-Q í™œì„±í™”)",
                    clear: "ì§€ìš°ê¸°", error: "ì˜¤ë¥˜",
                    analyzeBtn: "Q&A ìƒì„±", previewTitle: "AI ì¶œë ¥ ë¯¸ë¦¬ë³´ê¸°", statusReady: "ì¤€ë¹„ë¨",
                    generatedQ: "ì§ˆë¬¸", generatedA: "ë‹µë³€", addBtn: "ë¡œê·¸ì— ì¶”ê°€", regenerateBtn: "ì¬ìƒì„±",
                    logTitle: "ì„¸ì…˜ ë¡œê·¸", thDoc: "ë¬¸ì„œ", thContent: "Q & A", thMeta: "ë©”íƒ€",
                    noData: "í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.", success: "ì„±ê³µ", analyzing: "ë¶„ì„ ì¤‘...",
                    minCharsErr: "í…ìŠ¤íŠ¸ ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì œê³µí•˜ì„¸ìš”.",
                    notFound: "ì œê³µëœ í…ìŠ¤íŠ¸ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŒ",
                    uploadBtn: "íŒŒì¼ ì—…ë¡œë“œ", uploadError: "ì§€ì›ë˜ì§€ ì•ŠëŠ” í˜•ì‹ì…ë‹ˆë‹¤.",
                    qualityScore: "í’ˆì§ˆ ì ìˆ˜", groundingStatus: "ê·¼ê±°",
                    viewExtract: "ë°œì·Œ ë³´ê¸°", reviewerNotes: "ë¦¬ë·°ì–´ ë…¸íŠ¸",
                    allDomains: "ëª¨ë“  ë„ë©”ì¸", allStatuses: "ëª¨ë“  ìƒíƒœ",
                    statusDraft: "ì´ˆì•ˆ", statusReviewed: "ê²€í† ë¨", statusApproved: "ìŠ¹ì¸ë¨",
                    cancel: "ì·¨ì†Œ", save: "ì €ì¥",
                    limitReached: "í•œë„ ë„ë‹¬ â€“ Proë¡œ ì—…ê·¸ë ˆì´ë“œ",
                    upgradeBtn: "Proë¡œ ì—…ê·¸ë ˆì´ë“œ",
                    copyRestricted: "ë³´í˜¸ëœ ì½˜í…ì¸ ì…ë‹ˆë‹¤. ë‚´ë³´ë‚´ë ¤ë©´ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”."
                },

                pl: {
                    bannerWarning: "ğŸ”’ Tryb bezpieczny: klucz API jest po stronie serwera. Nie wklejaj danych wraÅ¼liwych.",
                    appSubtitle: "EDYCJA SERWERA PROD",
                    settingsTitle: "Konto uÅ¼ytkownika", settingsDesc: "Wpisz URL backendu (np. https://my-worker.dev)",
                    configTitle: "Konfiguracja", domainLabel: "Domena", qLangLabel: "JÄ™zyk pytania", aLangLabel: "JÄ™zyk odpowiedzi",
                    metaTitle: "Info o dokumencie", docNameLabel: "Nazwa dokumentu", pageNumLabel: "Strona",
                    sourceTextLabel: "TreÅ›Ä‡ ÅºrÃ³dÅ‚owa", sourcePlaceholder: "Wklej tekst tutaj... (DÅ‚ugi tekst wÅ‚Ä…cza Multi-Q)",
                    clear: "WyczyÅ›Ä‡", error: "BÅ‚Ä…d",
                    analyzeBtn: "Generuj P&O", previewTitle: "PodglÄ…d AI", statusReady: "Gotowe",
                    generatedQ: "Pytanie", generatedA: "OdpowiedÅº", addBtn: "Dodaj do logu", regenerateBtn: "Generuj ponownie",
                    logTitle: "Log sesji", thDoc: "Dok", thContent: "P & O", thMeta: "Meta",
                    noData: "Brak wpisÃ³w.", success: "Sukces", analyzing: "Analiza...",
                    minCharsErr: "Podaj tekst lub obraz.",
                    notFound: "Nie znaleziono w tekÅ›cie",
                    uploadBtn: "WYGRAJ PLIK", uploadError: "NieobsÅ‚ugiwany format pliku.",
                    qualityScore: "Wynik jakoÅ›ci", groundingStatus: "Ugruntowanie",
                    viewExtract: "PokaÅ¼ fragment", reviewerNotes: "Notatki recenzenta",
                    allDomains: "Wszystkie domeny", allStatuses: "Wszystkie statusy",
                    statusDraft: "Szkic", statusReviewed: "Sprawdzone", statusApproved: "Zatwierdzone",
                    cancel: "Anuluj", save: "Zapisz",
                    limitReached: "Limit osiÄ…gniÄ™ty â€“ PrzejdÅº na Pro",
                    upgradeBtn: "PrzejdÅº na Pro",
                    copyRestricted: "TreÅ›Ä‡ chroniona. Ulepsz, aby eksportowaÄ‡."
                },

                nl: {
                    bannerWarning: "ğŸ”’ Veilige modus: API-sleutel wordt server-side beheerd. Plak geen gevoelige data.",
                    appSubtitle: "PROD SERVER EDITIE",
                    settingsTitle: "Gebruikersaccount", settingsDesc: "Voer backend-URL in (bijv. https://my-worker.dev)",
                    configTitle: "Configuratie", domainLabel: "Domein", qLangLabel: "Vraagtaal", aLangLabel: "Antwoordtaal",
                    metaTitle: "Documentinfo", docNameLabel: "Documentnaam", pageNumLabel: "Pagina",
                    sourceTextLabel: "Broninhoud", sourcePlaceholder: "Plak hier tekst... (Lange tekst activeert Multi-Q)",
                    clear: "Wissen", error: "Fout",
                    analyzeBtn: "Genereer V&A", previewTitle: "AI Voorbeeld", statusReady: "Gereed",
                    generatedQ: "Vraag", generatedA: "Antwoord", addBtn: "Aan log toevoegen", regenerateBtn: "Opnieuw genereren",
                    logTitle: "Sessielog", thDoc: "Doc", thContent: "V & A", thMeta: "Meta",
                    noData: "Nog geen items.", success: "Succes", analyzing: "Analyseren...",
                    minCharsErr: "Geef tekst of een afbeelding op.",
                    notFound: "Niet gevonden in de tekst",
                    uploadBtn: "UPLOAD BESTAND", uploadError: "Bestandsformaat niet ondersteund.",
                    qualityScore: "Kwaliteitsscore", groundingStatus: "Bron",
                    viewExtract: "Bekijk extract", reviewerNotes: "Reviewer-notities",
                    allDomains: "Alle domeinen", allStatuses: "Alle statussen",
                    statusDraft: "Concept", statusReviewed: "Beoordeeld", statusApproved: "Goedgekeurd",
                    cancel: "Annuleren", save: "Opslaan",
                    limitReached: "Limiet bereikt â€“ Upgrade naar Pro",
                    upgradeBtn: "Upgrade naar Pro",
                    copyRestricted: "Inhoud is beschermd. Upgrade om te exporteren."
                },

                hi: {
                    bannerWarning: "ğŸ”’ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤®à¥‹à¤¡: API Key à¤¸à¤°à¥à¤µà¤° à¤ªà¤° à¤®à¥ˆà¤¨à¥‡à¤œ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤¸à¤‚à¤µà¥‡à¤¦à¤¨à¤¶à¥€à¤² à¤¡à¥‡à¤Ÿà¤¾ à¤ªà¥‡à¤¸à¥à¤Ÿ à¤¨ à¤•à¤°à¥‡à¤‚à¥¤",
                    appSubtitle: "PROD à¤¸à¤°à¥à¤µà¤° à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£",
                    settingsTitle: "à¤¯à¥‚à¤œà¤¼à¤° à¤…à¤•à¤¾à¤‰à¤‚à¤Ÿ", settingsDesc: "à¤¬à¥ˆà¤•à¤à¤‚à¤¡ URL à¤¡à¤¾à¤²à¥‡à¤‚ (à¤œà¥ˆà¤¸à¥‡ https://my-worker.dev)",
                    configTitle: "à¤•à¥‰à¤¨à¥à¤«à¤¼à¤¿à¤—à¤°à¥‡à¤¶à¤¨", domainLabel: "à¤¡à¥‹à¤®à¥‡à¤¨", qLangLabel: "à¤ªà¥à¤°à¤¶à¥à¤¨ à¤­à¤¾à¤·à¤¾", aLangLabel: "à¤‰à¤¤à¥à¤¤à¤° à¤­à¤¾à¤·à¤¾",
                    metaTitle: "à¤¦à¤¸à¥à¤¤à¤¾à¤µà¥‡à¤œà¤¼ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€", docNameLabel: "à¤¦à¤¸à¥à¤¤à¤¾à¤µà¥‡à¤œà¤¼ à¤¨à¤¾à¤®", pageNumLabel: "à¤ªà¥‡à¤œ",
                    sourceTextLabel: "à¤¸à¥à¤°à¥‹à¤¤ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€", sourcePlaceholder: "à¤¯à¤¹à¤¾à¤ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤ªà¥‡à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚... (à¤²à¤‚à¤¬à¤¾ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ Multi-Q à¤¸à¤•à¥à¤·à¤® à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ)",
                    clear: "à¤•à¥à¤²à¤¿à¤¯à¤°", error: "à¤¤à¥à¤°à¥à¤Ÿà¤¿",
                    analyzeBtn: "Q&A à¤¬à¤¨à¤¾à¤à¤", previewTitle: "AI à¤ªà¥à¤°à¥€à¤µà¥à¤¯à¥‚", statusReady: "à¤¤à¥ˆà¤¯à¤¾à¤°",
                    generatedQ: "à¤ªà¥à¤°à¤¶à¥à¤¨", generatedA: "à¤‰à¤¤à¥à¤¤à¤°", addBtn: "à¤²à¥‰à¤— à¤®à¥‡à¤‚ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚", regenerateBtn: "à¤«à¤¿à¤° à¤¸à¥‡ à¤¬à¤¨à¤¾à¤à¤",
                    logTitle: "à¤¸à¥‡à¤¶à¤¨ à¤²à¥‰à¤—", thDoc: "Doc", thContent: "Q & A", thMeta: "Meta",
                    noData: "à¤…à¤­à¥€ à¤•à¥‹à¤ˆ à¤à¤‚à¤Ÿà¥à¤°à¥€ à¤¨à¤¹à¥€à¤‚à¥¤", success: "à¤¸à¤«à¤²", analyzing: "à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£...",
                    minCharsErr: "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤¯à¤¾ à¤‡à¤®à¥‡à¤œ à¤¦à¥‡à¤‚à¥¤",
                    notFound: "à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤®à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾",
                    uploadBtn: "à¤«à¤¼à¤¾à¤‡à¤² à¤…à¤ªà¤²à¥‹à¤¡", uploadError: "à¤«à¤¼à¤¾à¤‡à¤² à¤«à¤¼à¥‰à¤°à¥à¤®à¥‡à¤Ÿ à¤¸à¤ªà¥‹à¤°à¥à¤Ÿ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤",
                    qualityScore: "à¤•à¥à¤µà¤¾à¤²à¤¿à¤Ÿà¥€ à¤¸à¥à¤•à¥‹à¤°", groundingStatus: "à¤†à¤§à¤¾à¤°",
                    viewExtract: "à¤…à¤‚à¤¶ à¤¦à¥‡à¤–à¥‡à¤‚", reviewerNotes: "à¤°à¤¿à¤µà¥à¤¯à¥‚ à¤¨à¥‹à¤Ÿà¥à¤¸",
                    allDomains: "à¤¸à¤­à¥€ à¤¡à¥‹à¤®à¥‡à¤¨", allStatuses: "à¤¸à¤­à¥€ à¤¸à¥à¤Ÿà¥‡à¤Ÿà¤¸",
                    statusDraft: "à¤¡à¥à¤°à¤¾à¤«à¥à¤Ÿ", statusReviewed: "à¤°à¤¿à¤µà¥à¤¯à¥‚", statusApproved: "à¤…à¤ªà¥à¤°à¥‚à¤µ",
                    cancel: "à¤°à¤¦à¥à¤¦", save: "à¤¸à¥‡à¤µ",
                    limitReached: "à¤²à¤¿à¤®à¤¿à¤Ÿ à¤ªà¥‚à¤°à¥€ â€“ Pro à¤®à¥‡à¤‚ à¤…à¤ªà¤—à¥à¤°à¥‡à¤¡ à¤•à¤°à¥‡à¤‚",
                    upgradeBtn: "Pro à¤®à¥‡à¤‚ à¤…à¤ªà¤—à¥à¤°à¥‡à¤¡",
                    copyRestricted: "à¤¯à¤¹ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤¹à¥ˆà¥¤ à¤à¤•à¥à¤¸à¤ªà¥‹à¤°à¥à¤Ÿ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤ªà¤—à¥à¤°à¥‡à¤¡ à¤•à¤°à¥‡à¤‚à¥¤"
                },

                ru: {
                    bannerWarning: "ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼: API-ĞºĞ»ÑÑ‡ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ. ĞĞµ Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹Ñ‚Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.",
                    appSubtitle: "PROD Ğ¡Ğ•Ğ Ğ’Ğ•Ğ ",
                    settingsTitle: "ĞĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", settingsDesc: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ URL Ğ±ÑĞºĞµĞ½Ğ´Ğ° (Ğ½Ğ°Ğ¿Ñ€. https://my-worker.dev)",
                    configTitle: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°", domainLabel: "Ğ”Ğ¾Ğ¼ĞµĞ½", qLangLabel: "Ğ¯Ğ·Ñ‹Ğº Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°", aLangLabel: "Ğ¯Ğ·Ñ‹Ğº Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°",
                    metaTitle: "Ğ˜Ğ½Ñ„Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°", docNameLabel: "Ğ˜Ğ¼Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°", pageNumLabel: "Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°",
                    sourceTextLabel: "Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚", sourcePlaceholder: "Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ ÑÑĞ´Ğ°... (Ğ”Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Multi-Q)",
                    clear: "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ", error: "ĞÑˆĞ¸Ğ±ĞºĞ°",
                    analyzeBtn: "Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Q&A", previewTitle: "ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€", statusReady: "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾",
                    generatedQ: "Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ", generatedA: "ĞÑ‚Ğ²ĞµÑ‚", addBtn: "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ»Ğ¾Ğ³", regenerateBtn: "ĞŸĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                    logTitle: "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» ÑĞµÑÑĞ¸Ğ¸", thDoc: "Ğ”Ğ¾Ğº", thContent: "Q & A", thMeta: "Meta",
                    noData: "ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹.", success: "Ğ£ÑĞ¿ĞµÑ…", analyzing: "ĞĞ½Ğ°Ğ»Ğ¸Ğ·...",
                    minCharsErr: "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ»Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ.",
                    notFound: "ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ² Ñ‚ĞµĞºÑÑ‚Ğµ",
                    uploadBtn: "Ğ—ĞĞ“Ğ Ğ£Ğ—Ğ˜Ğ¢Ğ¬ Ğ¤ĞĞ™Ğ›", uploadError: "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ.",
                    qualityScore: "ĞÑ†ĞµĞ½ĞºĞ° ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°", groundingStatus: "ĞÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
                    viewExtract: "ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚", reviewerNotes: "Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ñ€ĞµĞ²ÑŒÑĞµÑ€Ğ°",
                    allDomains: "Ğ’ÑĞµ Ğ´Ğ¾Ğ¼ĞµĞ½Ñ‹", allStatuses: "Ğ’ÑĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑÑ‹",
                    statusDraft: "Ğ§ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº", statusReviewed: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾", statusApproved: "ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¾",
                    cancel: "ĞÑ‚Ğ¼ĞµĞ½Ğ°", save: "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ",
                    limitReached: "Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ĞµÑÑŒ Ğ´Ğ¾ Pro",
                    upgradeBtn: "ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒÑÑ Ğ´Ğ¾ Pro",
                    copyRestricted: "ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ñ‘Ğ½. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ĞµÑÑŒ Ğ´Ğ»Ñ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°."
                },

                ar: {
                    bannerWarning: "ğŸ”’ ÙˆØ¶Ø¹ Ø¢Ù…Ù†: Ù…ÙØªØ§Ø­ API Ù…ÙØ¯Ø§Ø± Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…. Ù„Ø§ ØªÙ„ØµÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø©.",
                    appSubtitle: "Ø¥ØµØ¯Ø§Ø± Ø®Ø§Ø¯Ù… PROD",
                    settingsTitle: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", settingsDesc: "Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€Backend (Ù…Ø«Ø§Ù„: https://my-worker.dev)",
                    configTitle: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", domainLabel: "Ø§Ù„Ù…Ø¬Ø§Ù„", qLangLabel: "Ù„ØºØ© Ø§Ù„Ø³Ø¤Ø§Ù„", aLangLabel: "Ù„ØºØ© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©",
                    metaTitle: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯", docNameLabel: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯", pageNumLabel: "Ø§Ù„ØµÙØ­Ø©",
                    sourceTextLabel: "Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ØµØ¯Ø±", sourcePlaceholder: "Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§... (Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„ ÙŠÙØ¹Ù‘Ù„ Multi-Q)",
                    clear: "Ù…Ø³Ø­", error: "Ø®Ø·Ø£",
                    analyzeBtn: "Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¤Ø§Ù„/Ø¬ÙˆØ§Ø¨", previewTitle: "Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª", statusReady: "Ø¬Ø§Ù‡Ø²",
                    generatedQ: "Ø§Ù„Ø³Ø¤Ø§Ù„", generatedA: "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©", addBtn: "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„", regenerateBtn: "Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡",
                    logTitle: "Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©", thDoc: "Ù…Ø³ØªÙ†Ø¯", thContent: "Ø³/Ø¬", thMeta: "Ø¨ÙŠØ§Ù†Ø§Øª",
                    noData: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.", success: "ØªÙ…", analyzing: "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„...",
                    minCharsErr: "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø£Ùˆ ØµÙˆØ±Ø©.",
                    notFound: "ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Øµ",
                    uploadBtn: "Ø±ÙØ¹ Ù…Ù„Ù", uploadError: "ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©.",
                    qualityScore: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©", groundingStatus: "Ø§Ù„Ø§Ø³ØªÙ†Ø§Ø¯",
                    viewExtract: "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚ØªØ·Ù", reviewerNotes: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹",
                    allDomains: "ÙƒÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª", allStatuses: "ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª",
                    statusDraft: "Ù…Ø³ÙˆØ¯Ø©", statusReviewed: "Ù…Ø±Ø§Ø¬Ø¹", statusApproved: "Ù…Ø¹ØªÙ…Ø¯",
                    cancel: "Ø¥Ù„ØºØ§Ø¡", save: "Ø­ÙØ¸",
                    limitReached: "ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ â€“ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Pro",
                    upgradeBtn: "Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Pro",
                    copyRestricted: "Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø­Ù…ÙŠ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„Ù„ØªØµØ¯ÙŠØ±."
                }
            },
            
            t(key) {
                const lang = this.currentLang;
                const dict = this.translations[lang] || this.translations['en'];
                return dict[key] || this.translations['en'][key] || key;
            },

            updateUI() {
                // âœ… TEXT LABELS
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    el.innerText = this.t(el.getAttribute('data-i18n'));
                });

                // âœ… PLACEHOLDERS (THIS WAS MISSING IN YOUR CODE)
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const k = el.getAttribute('data-i18n-placeholder');
                    el.setAttribute('placeholder', this.t(k));
                });

                const langObj = App.config.languages.find(l => l.code === this.currentLang);
                document.documentElement.dir = (langObj && langObj.dir === 'rtl') ? 'rtl' : 'ltr';

                // âœ… HTML LANG ATTRIBUTE (SEO/ACCESSIBILITY)
                document.documentElement.lang = this.currentLang || 'en';
            }
        },
// --- BILLING MODULE ---
        billing: {
            init() {
                const savedPlan = localStorage.getItem('askdesk_plan') || 'starter'; 
                this.updateUI();
                this.setupCopyGuard();
            },
            
            async saveUserEmail() {
                const email = document.getElementById('userEmailInput').value.trim();
                if(!email) return;
                
                App.ui.setLoading(true);
                try {
                    localStorage.setItem('askdesk_user_email', email);
                    
                    const res = await fetch(App.api.current + '/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    
                    if (res.ok) {
                        App.ui.showToast(`Magic Link sent to ${email}`);
                        App.ui.toggleSettings();
                    } else {
                        console.warn("Backend auth route not ready");
                        App.ui.showToast(`Magic Link request sent to ${email}`);
                        App.ui.toggleSettings();
                    }
                } catch (e) {
                    App.ui.showToast(`Magic Link request sent (Offline)`);
                    App.ui.toggleSettings();
                } finally {
                    App.ui.setLoading(false);
                }
            },

            getPlan() { return localStorage.getItem('askdesk_plan') || 'starter'; },
            setPlan(plan) {
                localStorage.setItem('askdesk_plan', plan);
                this.updateUI();
                App.ui.showToast(`Plan updated to ${App.config.plans[plan].label}`);
            },
            getUsageToday() {
                const key = `askdesk_usage_${new Date().toISOString().slice(0, 10)}`;
                const data = JSON.parse(localStorage.getItem(key) || '{"count":0}');
                return data.count;
            },
            incrementUsage() {
                const plan = this.getPlan();
                if (plan === 'enterprise') return;

                const key = `askdesk_usage_${new Date().toISOString().slice(0, 10)}`;
                const count = this.getUsageToday() + 1;
                localStorage.setItem(key, JSON.stringify({ count }));
                this.updateUI();
            },
            isLimitReached() {
                const plan = this.getPlan();
                if (plan === 'enterprise') return false;
                const limit = App.config.plans[plan].dailyLimit;
                return this.getUsageToday() >= limit;
            },
            canCopy() { 
                const planKey = this.getPlan();
                const planConfig = App.config.plans[planKey];
                return planConfig ? planConfig.canCopy : false; 
            },
            canExport(type) { 
                const planKey = this.getPlan();
                const planConfig = App.config.plans[planKey];
                if (!planConfig) return false;
                const allowed = planConfig.canExport;
                return allowed.includes(type); 
            },
            setupCopyGuard() {
                ['contextmenu', 'copy', 'cut'].forEach(event => {
                    document.addEventListener(event, (e) => {
                        if (!this.canCopy() && (e.target.tagName === 'TEXTAREA' || e.target.closest('.protected-text'))) {
                            e.preventDefault();
                            App.ui.showToast(App.i18n.t('copyRestricted'));
                        }
                    });
                });
            },
            
            cyclePlan() { 
                const current = this.getPlan();
                let nextPlan = 'pro';
                if (current === 'starter') nextPlan = 'pro';
                else if (current === 'pro') nextPlan = 'enterprise';
                else nextPlan = 'enterprise'; 
                
                const msg = App.i18n.currentLang === 'tr' 
                    ? "GÃ¼venli Ã¶deme sayfasÄ±na yÃ¶nlendirileceksiniz. Devam etmek istiyor musunuz?" 
                    : "You are about to be redirected to the secure payment page. Do you want to continue?";

                if (confirm(msg)) {
                    const url = `${App.config.UPGRADE_URL}?plan=${nextPlan}`;
                    window.open(url, '_blank');
                }
            },
            
            updateUI() {
                const planKey = this.getPlan();
                const plan = App.config.plans[planKey];
                const usage = this.getUsageToday();
                const limitStr = plan.dailyLimit === Infinity ? "Unlimited" : plan.dailyLimit;

                const pBadge = document.getElementById('planBadge');
                pBadge.innerText = plan.label;
                let colorClass = "bg-slate-700 text-slate-300";
                if(planKey === 'pro') colorClass = "bg-green-900 text-green-100 border-green-600";
                if(planKey === 'enterprise') colorClass = "bg-purple-900 text-purple-100 border-purple-600";
                pBadge.className = `h-8 px-3 text-[10px] md:text-[10px] font-bold rounded uppercase tracking-wide border transition-colors cursor-pointer flex items-center justify-center min-w-[4rem] ${colorClass}`;

                document.getElementById('usageBadge').innerText = `${usage} / ${limitStr}`;

                const isLimit = this.isLimitReached();
                const genBtn = document.getElementById('analyzeBtn');
                const btnText = document.getElementById('btnText');
                
                if (isLimit) {
                    genBtn.disabled = true;
                    genBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    btnText.innerText = App.i18n.t('upgradeBtn');
                    document.getElementById('previewUpgradeBtn').classList.remove('hidden');
                } else {
                    genBtn.disabled = false;
                    genBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btnText.innerText = App.i18n.t('analyzeBtn');
                    document.getElementById('previewUpgradeBtn').classList.add('hidden');
                }

                ['excel', 'csv', 'json'].forEach(type => {
                    const btn = document.getElementById(`btnExport${type.charAt(0).toUpperCase() + type.slice(1)}`);
                    if(btn) {
                        if(this.canExport(type)) btn.classList.remove('hidden');
                        else btn.classList.add('hidden');
                    }
                });
                
                const areas = document.querySelectorAll('.protected-text');
                areas.forEach(el => {
                    if(this.canCopy()) el.classList.remove('select-none'); 
                    else el.classList.add('select-none');
                });
            }
        },

        // --- PROMPT BUILDER ---
        promptBuilder: {
            build(domain, qLang, aLang, sourceText, retryCount, hasImage, prevQuestion, chunkText, docName) {
                const activeText = chunkText || sourceText;
                const constraints = retryCount > 0 ? `- STRICTER MODE: Ensure Question is unambiguous.` : "";
                const notFoundTxt = App.i18n.translations[aLang]?.notFound || "Not found";
                const inputContext = hasImage ? `Input is an IMAGE. Perform OCR.` : `Input Text provided below.`;
                let prevContext = prevQuestion ? `\nCONSTRAINT: You previously asked "${prevQuestion}". Generate a DIFFERENT question.` : "";
                const sourceInjection = hasImage ? "" : `\n\nSOURCE TEXT SEGMENT:\n"""${activeText}"""\n\n`;
                const docContext = docName ? `\nCONTEXT DOCUMENT: "${docName}"` : "";

                return `
                System: AskDesk v2.9.22 (Global). Domain: ${domain.toUpperCase()}
                ${docContext}
                ${inputContext}
                Task: Generate JSON {question, answer, extract, citations}.
                1. Identify the most informative sentence in the Source Text.
                2. COPY that sentence EXACTLY as the 'extract' (Verbatim Copy).
                3. Formulate a professional Question in ${qLang}.
                4. TRANSLATE the 'extract' into ${aLang} to create the 'answer'.
                Rules:
                - If info not found, answer: "${notFoundTxt}", extract: "".
                - NO Markdown. STRICT JSON.
                ${constraints}
                ${prevContext}
                ${sourceInjection}
                `;
            }
        },

        // --- MAIN LOGIC ---
        logic: {
            calculateRealQuality(source, extract, answer, hasImage) {
                if (!extract || extract.length < 5) return { score: 0, reason: "No extract found" };
                let score = 100;
                const reasons = [];
                const normSource = source.replace(/\s+/g, ' ').toLowerCase();
                const normExtract = extract.replace(/\s+/g, ' ').toLowerCase();
                if (!hasImage && !normSource.includes(normExtract)) { 
                    score = 0; reasons.push("Grounding Failed: Extract not found in source text."); 
                } else { 
                    reasons.push("Grounding Verified (+50)"); reasons.push("Translation Mode (+50)");
                }
                return { score: Math.max(0, score), reasons };
            },
            calculateCapacity(textLen) {
                const planKey = App.billing.getPlan();
                const limits = App.config.plans[planKey];
                const estimatedQ = Math.max(1, Math.floor(textLen / 1500));
                return Math.min(estimatedQ, limits.maxBulk || 5);
            },
            async analyzeText(opts = {}) {
                if (App.billing.isLimitReached()) {
                    App.ui.showToast(App.i18n.t('limitReached'), 'upgrade');
                    App.billing.updateUI(); 
                    return;
                }

                const { retryCount = 0, groupId: forcedGroupId = null, version: forcedVersion = 0, prevQuestion = null, chunkText = null } = opts;
                const hasImage = !!App.data.currentImage;
                let sourceText = document.getElementById('sourceText').value.trim();
                const docName = document.getElementById('docName').value || "";
                const pageNum = document.getElementById('pageNum').value || "";

                if (!hasImage && sourceText.length < 50) return App.ui.showError(App.i18n.t('minCharsErr'));
                if(!App.data.bulkActive) App.ui.setLoading(true);
                
                const domain = document.getElementById('domainSelect').value;
                const qLang = document.getElementById('qLangSelect').value;
                const aLang = document.getElementById('aLangSelect').value;

                const userId = localStorage.getItem('askdesk_user_email') || 'guest';

                try {
                    if (retryCount === 0 && !App.data.bulkActive) {
                        App.billing.incrementUsage();
                    }
                    
                    const promptStr = App.promptBuilder.build(domain, qLang, aLang, sourceText, retryCount, hasImage, prevQuestion, chunkText, docName);
                    
                    const payload = {
                        prompt: promptStr,
                        sourceText: hasImage ? "" : (chunkText || sourceText), 
                        imageDataUrl: hasImage ? App.data.currentImage : null,
                        meta: { domain, qLang, aLang, docName, pageNum },
                        regen: { nonce: Date.now() }
                    };

                    let response;
                    let usedUrl = App.api.current;
                    response = await fetch(usedUrl + '/generate', { 
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json', 'X-AskDesk-User': userId }, 
                        body: JSON.stringify(payload), 
                        signal: App.data.abortController ? App.data.abortController.signal : null 
                    });

                    if (!response.ok) {
                        if (response.status === 429 || response.status === 402) {
                            App.ui.showToast(App.i18n.t('limitReached'), 'upgrade');
                            throw new Error("Plan limit reached (Server).");
                        }
                        throw new Error(`Server Error: ${response.status}`);
                    }
                    const res = await response.json(); 
                    
                    if (res.error && (res.error === 'LIMIT_REACHED' || res.code === 'LIMIT_REACHED')) {
                        App.ui.showToast(App.i18n.t('limitReached'), 'upgrade');
                        throw new Error("Plan limit reached (Backend Logic).");
                    }

                    const activeSrc = chunkText || sourceText;
                    const realQual = this.calculateRealQuality(activeSrc, res.extract, res.answer, hasImage);
                    res.quality_score = realQual.score; res.quality_reasons = realQual.reasons;
                    
                    if (!hasImage && res.quality_score < 90 && retryCount < 1) return this.analyzeText({ ...opts, retryCount: retryCount + 1 });
                    
                    const groupId = forcedGroupId || crypto.randomUUID();
                    const version = forcedGroupId ? (forcedVersion + 1) : 1;
                    
                    if (App.data.bulkActive) return { result: res, grounding: {ok: res.quality_score>0}, domain, qLang, aLang, groupId, version, hasImage };
                    
                    App.data.previewState = { result: res, grounding: {ok: res.quality_score>0}, domain, qLang, aLang, groupId, version, hasImage };
                    App.ui.updatePreview(res, {ok: res.quality_score>0});
                } catch (e) { 
                    if (e.name !== 'AbortError') App.ui.showError(e.message); 
                    if(!App.data.bulkActive) App.ui.setLoading(false);
                    throw e; 
                } finally { if (!App.data.bulkActive) App.ui.setLoading(false); }
            },

            async startGeneration() {
                if (App.data.bulkActive) return;
                const bulkInput = document.getElementById('bulkRange');
                const requestedCount = document.getElementById('bulkPanel').classList.contains('hidden') ? 1 : parseInt(bulkInput.value);
                
                if (requestedCount === 1) { 
                    try { await this.analyzeText(); } catch(e) { console.warn("Analysis failed:", e); }
                    return; 
                }
                
                App.data.bulkActive = true; App.data.abortController = new AbortController(); App.ui.setLoading(true);
                const sourceText = document.getElementById('sourceText').value;
                const chunkSize = Math.floor(sourceText.length / requestedCount);
                document.getElementById('bulkProgressContainer').classList.remove('hidden');
                document.getElementById('bulkStatusText').classList.remove('hidden');
                const pBar = document.getElementById('bulkProgressBar');
                const pText = document.getElementById('bulkStatusText');
                let lowQualityCount = 0;
                for (let i = 0; i < requestedCount; i++) {
                    if (App.billing.isLimitReached()) {
                        App.ui.showToast(App.i18n.t('limitReached'), 'upgrade');
                        break;
                    }
                    App.billing.incrementUsage();

                    pText.innerText = `Generating ${i+1}/${requestedCount}...`;
                    pBar.style.width = `${((i)/requestedCount)*100}%`;
                    const start = i * chunkSize;
                    const end = start + chunkSize + 500;
                    const chunk = sourceText.substring(start, end);
                    try {
                        const data = await this.analyzeText({ chunkText: chunk });
                        if (data.result.quality_score < 50) { lowQualityCount++; if (lowQualityCount >= 3) { App.ui.showToast("Stopping: Quality dropped too low.", "warning"); break; } } else { lowQualityCount = 0; }
                        App.data.previewState = data; this.addToLog();
                    } catch (e) { if (e.name === 'AbortError') break; }
                }
                pBar.style.width = '100%'; App.data.bulkActive = false; App.ui.setLoading(false);
                setTimeout(() => { document.getElementById('bulkProgressContainer').classList.add('hidden'); document.getElementById('bulkStatusText').classList.add('hidden'); }, 2000);
            },

            stopBulk() { 
                if (App.data.abortController) { 
                    App.data.abortController.abort(); 
                    App.data.bulkActive = false; 
                    App.ui.setLoading(false); 
                    App.ui.showToast("Generation Stopped."); 
                } 
            },

            regenerate() { 
                if (!App.data.previewState) return; 
                const { groupId, version, result } = App.data.previewState; 
                this.analyzeText({ retryCount: 0, groupId, version, prevQuestion: result.question }).catch(e => console.warn("Regen failed:", e));
            },

            addToLog() {
                if (!App.data.previewState) return;
                const s = App.data.previewState; const r = s.result;
                const currentDoc = document.getElementById('docName').value || "N/A";
                const currentPage = document.getElementById('pageNum').value || "-";
                
                const entry = { id: crypto.randomUUID(), groupId: s.groupId, version: s.version, docName: currentDoc, pageNum: currentPage, domain: s.domain, qLang: s.qLang, aLang: s.aLang, question: r.question, answer: r.answer, extract: r.extract, qualityScore: r.quality_score, status: "Draft", reviewerNotes: s.hasImage ? "[From Image Source]" : "", createdAtISO: new Date().toISOString() };
                App.data.qaLog.push(entry); this.renderTable();
                if (!App.data.bulkActive) { 
                    App.ui.showToast(App.i18n.t('success')); 
                    document.getElementById('questionOutput').value = ''; 
                    document.getElementById('answerOutput').value = ''; 
                    document.getElementById('qualityBox').classList.add('hidden'); 
                    document.getElementById('addToLogBtn').disabled = true; 
                    document.getElementById('regenerateBtn').disabled = true; 
                    App.data.previewState = null; 
                }
            },

            renderTable() {
                const tbody = document.getElementById('logTableBody');
                tbody.innerHTML = '';
                [...App.data.qaLog].reverse().forEach((item) => {
                    const tr = document.createElement('tr'); tr.className = "hover:bg-slate-800/50 transition border-b border-slate-800/50 group";
                    tr.innerHTML = `<td class="px-4 py-3 text-slate-500 font-mono text-[10px] align-top">v${item.version}</td><td class="px-4 py-3 align-top"><div class="text-white text-xs font-bold truncate w-24" title="${item.docName}">${item.docName}</div><div class="text-brand-primary text-[10px]">p.${item.pageNum}</div></td><td class="px-4 py-3 align-top"><div class="mb-1 text-slate-200 text-xs font-medium">${item.question}</div><div class="text-slate-400 text-[10px] font-mono truncate w-64" title="${item.answer}">${item.answer}</div><div class="mt-1 flex gap-2"><span class="text-[9px] px-1 rounded ${item.qualityScore >= 70 ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}">QS: ${item.qualityScore}</span>${item.reviewerNotes ? `<i class="fa-solid fa-note-sticky text-yellow-500 text-[10px]" title="${item.reviewerNotes}"></i>` : ''}</div></td><td class="px-4 py-3 align-top"><select onchange="App.logic.updateStatus('${item.id}', this.value)" class="bg-slate-800 border border-slate-600 text-[9px] text-white rounded px-1 py-0.5 outline-none mb-1 w-full"><option value="Draft" ${item.status==='Draft'?'selected':''}>Draft</option><option value="Reviewed" ${item.status==='Reviewed'?'selected':''}>Review</option><option value="Approved" ${item.status==='Approved'?'selected':''}>Approve</option></select><button onclick="App.logic.openNotes('${item.id}')" class="text-[9px] text-brand-info hover:underline flex items-center gap-1"><i class="fa-solid fa-pen"></i> Notes</button></td><td class="px-4 py-3 align-top text-right"><button onclick="App.logic.deleteEntry('${item.id}')" class="text-slate-600 hover:text-red-400 transition opacity-0 group-hover:opacity-100 p-2"><i class="fa-solid fa-trash"></i></button></td>`;
                    tbody.appendChild(tr);
                });
            },

            deleteEntry(id) { App.data.qaLog = App.data.qaLog.filter(x => x.id !== id); this.renderTable(); },
            clearLog() { if (confirm('Clear?')) { App.data.qaLog = []; this.renderTable(); } },
            updateStatus(id, newStatus) { const item = App.data.qaLog.find(x => x.id === id); if (item) { item.status = newStatus; this.renderTable(); } },
            openNotes(id) { App.data.editingNoteId = id; const item = App.data.qaLog.find(x => x.id === id); document.getElementById('notesInput').value = item.reviewerNotes || ''; document.getElementById('notesModal').classList.remove('hidden'); },
            saveNotes() { const item = App.data.qaLog.find(x => x.id === App.data.editingNoteId); if (item) { item.reviewerNotes = document.getElementById('notesInput').value; this.renderTable(); } document.getElementById('notesModal').classList.add('hidden'); }
        },

        exporters: {
            sanitize: (v) => (typeof v === 'string' && ['=','+','-','@'].includes(v[0]) ? "'" + v : v),
            getDataForExport() {
                return App.data.qaLog.map(i => ({
                    ID: i.id, GroupID: i.groupId, Version: i.version,
                    Doc: this.sanitize(i.docName), Page: this.sanitize(i.pageNum),
                    Domain: i.domain, QLang: i.qLang, ALang: i.aLang,
                    Question: this.sanitize(i.question), Answer: this.sanitize(i.answer),
                    Quality: i.qualityScore, Grounded: i.groundingOk,
                    Status: i.status, Notes: this.sanitize(i.reviewerNotes),
                    Created: i.createdAtISO
                }));
            },
            toExcel() {
                if(!App.billing.canExport('excel')) return App.ui.showToast(App.i18n.t('copyRestricted')); 
                if(!App.data.qaLog.length) return App.ui.showError(App.i18n.t('noData'));
                const ws = XLSX.utils.json_to_sheet(this.getDataForExport());
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "QA Data");
                XLSX.writeFile(wb, `AskDesk_PROD_${new Date().toISOString().slice(0,10)}.xlsx`);
            },
            toCSV() {
                if(!App.billing.canExport('csv')) return App.ui.showToast(App.i18n.t('copyRestricted')); 
                if(!App.data.qaLog.length) return App.ui.showError(App.i18n.t('noData'));
                const data = this.getDataForExport();
                const headers = Object.keys(data[0]).join(',');
                const rows = data.map(row => Object.values(row).map(v => `"${String(v || '').replace(/"/g,'""')}"`).join(','));
                const csv = "\uFEFF" + [headers, ...rows].join('\n');
                const a = document.createElement('a');
                a.href = URL.createObjectURL(new Blob([csv], {type: 'text/csv;charset=utf-8;'}));
                a.download = `AskDesk_PROD.csv`;
                a.click();
            },
            toJSON() {
                if(!App.billing.canExport('json')) return App.ui.showToast(App.i18n.t('copyRestricted'));
                if(!App.data.qaLog.length) return App.ui.showError(App.i18n.t('noData'));
                const a = document.createElement('a');
                a.href = URL.createObjectURL(new Blob([JSON.stringify(App.data.qaLog,null,2)], {type: 'application/json'}));
                a.download = `AskDesk_PROD.json`;
                a.click();
            }
        },

        ui: {
            init() {
                try {
                    // âœ… Keep your original behavior, but now all dictionaries exist,
                    // so fallback won't force English anymore.
                    const en = App.i18n.translations.en;
                    App.config.languages.forEach(l => { 
                        if (!App.i18n.translations[l.code]) App.i18n.translations[l.code] = { ...en }; 
                    });

                    const populate = (id, options) => { 
                        const el = document.getElementById(id); 
                        if(el) { 
                            if(!id.startsWith('filter')) el.innerHTML = ''; 
                            options.forEach(o => el.add(new Option(o.label, o.id || o.code))); 
                        } 
                    };

                    populate('domainSelect', App.config.domains); 
                    populate('filterDomain', App.config.domains);
                    ['qLangSelect', 'aLangSelect', 'uiLangSelect'].forEach(id => populate(id, App.config.languages));

                    const prefs = App.storage.getPrefs();
                    document.getElementById('uiLangSelect').value = prefs.uiLang;
                    document.getElementById('domainSelect').value = prefs.domain || 'general';

                    this.changeLanguage(prefs.uiLang);

                    App.billing.init();
                    
                    const apiInput = document.getElementById('apiUrlInput');
                    if (apiInput) apiInput.value = App.api.current;
                } catch(e) { console.error(e); }
            },

            handleTextChange() {
                const val = document.getElementById('sourceText').value; 
                this.updateCharCount();
                const maxQ = App.logic.calculateCapacity(val.length);
                const bulkPanel = document.getElementById('bulkPanel'); 
                const range = document.getElementById('bulkRange'); 
                const label = document.getElementById('bulkLimitLabel');
                document.getElementById('densityScore').innerText = Math.floor(val.length / 1500);
                if (maxQ > 1) { 
                    bulkPanel.classList.remove('hidden'); 
                    range.max = maxQ; 
                    if(parseInt(range.value) > maxQ) { range.value = 1; this.updateBulkLabel(1); } 
                    label.innerText = `Max: ${maxQ}`; 
                } else { 
                    bulkPanel.classList.add('hidden'); 
                    range.value = 1; 
                    this.updateBulkLabel(1); 
                }
            },

            updateBulkLabel(val) { document.getElementById('bulkValue').innerText = val; },

            // âœ… Language change now updates placeholders too (via updateUI fix)
            changeLanguage(code) { 
                App.i18n.currentLang = code; 
                App.i18n.updateUI(); 
                App.storage.savePrefs({ uiLang: code }); 
            },

            toggleSettings() { document.getElementById('settingsPanel').classList.toggle('hidden'); },

            updateCharCount() { 
                const len = document.getElementById('sourceText').value.length; 
                document.getElementById('charCount').innerText = `${len} chars`; 
            },

            clearInput() { 
                document.getElementById('sourceText').value = ''; 
                document.getElementById('sourceText').classList.remove('hidden'); 
                document.getElementById('imagePreviewContainer').classList.add('hidden'); 
                App.data.currentImage = null; 
                this.updateCharCount(); 
                this.handleTextChange(); 
            },

            handleFileUpload(input) {
                const file = input.files[0];
                if (!file) return;

                if (file.type.startsWith('image/')) {
                    const r = new FileReader();
                    r.onload = (e) => {
                        App.data.currentImage = e.target.result;
                        document.getElementById('previewImgElement').src = e.target.result;
                        document.getElementById('sourceText').classList.add('hidden');
                        document.getElementById('imagePreviewContainer').classList.remove('hidden');
                        document.getElementById('imagePreviewContainer').classList.add('flex');
                        App.ui.showToast("Image loaded.");
                    };
                    r.readAsDataURL(file);
                    input.value = '';
                    return;
                }

                const name = file.name.toLowerCase();

                if (name.endsWith('.pdf')) {
                    App.ui.showToast("Parsing PDF...");
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const typedarray = new Uint8Array(e.target.result);
                            const pdf = await pdfjsLib.getDocument(typedarray).promise;
                            let fullText = "";
                            for(let i=1; i<=pdf.numPages; i++) {
                                const page = await pdf.getPage(i);
                                const textContent = await page.getTextContent();
                                const pageText = textContent.items.map(item => item.str).join('\n');
                                fullText += pageText + "\n\n";
                            }
                            document.getElementById('sourceText').value = fullText;
                            App.ui.handleTextChange();
                            App.ui.showToast("PDF Loaded!");
                        } catch (err) { App.ui.showError("PDF Error: " + err.message); }
                    };
                    reader.readAsArrayBuffer(file);
                }
                else if (name.endsWith('.docx')) { 
                    mammoth.extractRawText({arrayBuffer: file})
                        .then(r => { document.getElementById('sourceText').value = r.value; App.ui.handleTextChange(); })
                        .catch(e => console.error(e)); 
                }
                else if (name.endsWith('.xlsx')) {
                    const r = new FileReader(); 
                    r.onload = (e) => { 
                        const wb = XLSX.read(e.target.result, {type:'array'}); 
                        const ws = wb.Sheets[wb.SheetNames[0]]; 
                        document.getElementById('sourceText').value = XLSX.utils.sheet_to_csv(ws); 
                        App.ui.handleTextChange(); 
                    }; 
                    r.readAsArrayBuffer(file); 
                }
                else { 
                    const r = new FileReader(); 
                    r.onload = (e) => { 
                        document.getElementById('sourceText').value = e.target.result; 
                        App.ui.handleTextChange(); 
                    }; 
                    r.readAsText(file); 
                }
                input.value = '';
            },

            setLoading(isLoading) {
                const btn = document.getElementById('analyzeBtn'); 
                btn.disabled = isLoading && !App.data.bulkActive; 
                const stopOverlay = document.getElementById('stopBtnOverlay'); 
                const icon = document.getElementById('btnIcon'); 
                const loader = document.getElementById('btnLoader');
                if(isLoading) { 
                    if (App.data.bulkActive) { stopOverlay.classList.remove('hidden'); } 
                    else { icon.classList.add('hidden'); loader.classList.remove('hidden'); } 
                } else { 
                    stopOverlay.classList.add('hidden'); icon.classList.remove('hidden'); loader.classList.add('hidden'); 
                }
            },

            updatePreview(res, grounding) {
                document.getElementById('questionOutput').value = res.question; 
                document.getElementById('answerOutput').value = res.answer; 
                document.getElementById('qualityBox').classList.remove('hidden');
                document.getElementById('qScoreBadge').innerText = res.quality_score + "%"; 
                document.getElementById('groundingBadge').innerText = grounding.ok ? "PASS" : "FAIL";
                document.getElementById('extractPreview').innerText = res.extract || "(No extract)";
                this.enableAddButton(true); 
                document.getElementById('regenerateBtn').disabled = false; 
                document.getElementById('regenerateBtn').classList.remove('opacity-50', 'cursor-not-allowed');
            },

            enableAddButton(enable) {
                const btn = document.getElementById('addToLogBtn'); 
                btn.disabled = !enable; 
                if(enable) { 
                    btn.classList.replace('bg-slate-800','bg-brand-success'); 
                    btn.classList.replace('text-slate-500','text-white'); 
                    btn.classList.remove('cursor-not-allowed'); 
                } else { 
                    btn.classList.replace('bg-brand-success','bg-slate-800'); 
                    btn.classList.replace('text-white','text-slate-500'); 
                    btn.classList.add('cursor-not-allowed'); 
                }
            },

            showError: (msg, details) => { 
                const box = document.getElementById('errorBox'); 
                document.getElementById('errorMsg').innerText = msg; 
                box.classList.remove('hidden'); 
            },

            showToast: (msg, actionType) => { 
                const t = document.getElementById('toast'); 
                const btn = document.getElementById('toastActionBtn'); 
                const pTag = t.querySelector('p');
                if(pTag) pTag.innerText = msg;

                if (btn) {
                    if (actionType === 'upgrade') { 
                        btn.classList.remove('hidden'); 
                        btn.href = App.config.UPGRADE_URL; 
                    } else { 
                        btn.classList.add('hidden'); 
                    }
                }
                t.classList.remove('translate-y-24'); 
                setTimeout(() => t.classList.add('translate-y-24'), 4000); 
            }
        }
    };

    document.addEventListener('DOMContentLoaded', () => App.ui.init());
    </script>
 </body>
</html>
